{% extends 'index.html' %}
{% block content %}
{% load static %}
{% include 'common/bootstrap.html' %}
<style>
    a {
        color: black;
    }

    .addproject {
        text-align: center;
        padding: 15px 15px;
        font-size: 15px;
        font-weight: bold;
        background-color: #00c200;
        color: white;
        font-size: 19px;
    }
</style>
<form class="pt-5" method="post">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
        <div class="p-1">
            <label class="p-1">Booking Report</label>
            <select class="form-control" id="reportType" name="reportType">
                <option value="" disabled selected hidden>Select Report</option>
                <option value="project">Project Wise</option>
                <option value="date">Date Wise</option>
                <option value="projhead">Proj Head Wise</option>
                <option value="executive">Executive Wise</option>
                <option value="payment">Payment Type Wise</option>
                <option value="paystatus">Pay Status Wise</option>
            </select>
        </div>
        <div id="dynamicDropdown" style="display: none;" class="p-1">
        </div>
    </div>
</form>
<br>
<div>
    <table class="table-responsive" class="emInfo responsive" >
        <thead>
            <tr><th>#</th>
                <th>Seniority</th>
                <th>Customer_Name</th>
                <th>Date_of_Booking</th>
                <th>Project</th>
                <th>Dimension</th>
                <th>AM_Number</th>
                <th>Mobile_No</th>
                <th>Alternate_No</th>
                <th>Email_ID</th>
                <th>Address</th>
                <th>Tot_Value</th>
                <th>DP_Value</th>
                <th>Tot_Paid</th>
                <th>Executive</th>
                <th>Proj_Head</th>
                <th>Pay_Status</th>
                <th>Payment_Type</th>
            </tr>
        </thead>
        <tbody>
            {% for val in bookings %}
            
                
                <tr>
                    <td>{{forloop.counter}}</td>
                    <td>{{val.seniority_id}}</td>
                    <td>{{val.user.first_name|upper}}</td>
                    <td>{{val.created_on|date:'d-m-y'}}</td>
                    <td>{{val.land_details.project.projectname}}</td>
                    <td>{{val.land_details.plotsize.plotsize}}</td>
                    <td>{{val.am_no}}</td>
                    <td>{{val.user.mobile_no}}</td>
                    <td>{{val.alter}}</td>
                    <td>{{val.user.email}}</td>
                    <td>{{val.address|upper}}</td>
                    <td>{{val.land_details.total_amount}}</td>
                    <td>{{val.land_details.down_payment}}</td>
                    <td>{{val.total_amt}}</td>
                    <td>{{val.exective|upper}}</td>
                    <td>{{val.project_lead|upper}}</td>
                    <td></td>
                    <td>{{val.paymentdetails_set.last.paymentname}}</td>
                </tr>
               
            {%endfor%}
        </tbody>
    </table>
</div>
<script>
    var reportTypeDropdown = document.getElementById('reportType');
    var dynamicDropdown = document.getElementById('dynamicDropdown');

    reportTypeDropdown.addEventListener('change', function () {
        var selectedOption = reportTypeDropdown.value;

        // 1st block
        if (selectedOption === 'project') {
            dynamicDropdown.innerHTML = `
            {% csrf_token %}
                <label class="p-1">Project Wise Options</label>
                <select class="form-control" id="projectOption" name="projectOption" onchange="this.form.submit()">
                    <option disabled selected hidden>Select Report Type</option>
                    <option value="all">All</option>
                    {% for data in project %}
                        <option value="{{ data.projectname }}">{{ data.projectname }}</option>
                    {% endfor %}
                </select>
            `;
            dynamicDropdown.style.display = 'block';
            // 2nd block
        } else if (selectedOption === 'date') {
            dynamicDropdown.innerHTML = `
                <label class="p-1">Date Wise Options</label>
                <select class="form-control" id="projectDate" name="projectDate">
                    <option disabled selected hidden>Select Report Type</option>
                    <option value="dateall">All</option>
                    <option value="">PERIOD (FROM <input type="date" class="form-control" id="fromDate" name="fromDate"> TO <input type="date" class="form-control" id="toDate" name="toDate">)</option>
                </select>
            `;
            dynamicDropdown.style.display = 'block';
            // 3rd block
        } else if (selectedOption === 'projhead') {
            dynamicDropdown.innerHTML = `
            <label class="p-1">Proj Head Wise</label>
                <select class="form-control" id="projecthead" name="projecthead">
                    <option disabled selected hidden>Select Report Type</option>
                    {% for mydata in book %}
                        <option value="{{ mydata.project_lead }}">{{ mydata.project_lead }}</option>
                    {% endfor %}
                </select>
            `;
            dynamicDropdown.style.display = 'block';
            // 4th block 
        } else if (selectedOption === 'executive') {
            dynamicDropdown.innerHTML = `
            <label class="p-1">Executive Wise</label>
                <select class="form-control" id="projectexe" name="projectexe">
                    <option disabled selected hidden>Select Report Type</option>
                    {% for mydata in book %}
                        <option value="{{ mydata.project_lead }}">{{ mydata.project_lead }}</option>
                    {% endfor %}
                </select>
            `;
            dynamicDropdown.style.display = 'block';
            // 5th block
        } else if (selectedOption === 'payment') {
            dynamicDropdown.innerHTML = `
            <label class="p-1">Payment Type Wise</label>
                <select class="form-control" id="payment" name="payment">
                    <option disabled selected hidden>Select Report Type</option>
                    <option value="paymentall">All</option>
                    <option value="down_payment">Down Payment</option>
                    <option value="first_install">First Installment</option>
                    <option value="second_install">Second Installment</option>
                    <option value="third_install">Third Installment</option>
                </select>
            `;
            dynamicDropdown.style.display = 'block';
            // 6th block
        } else if (selectedOption === 'paystatus') {
            dynamicDropdown.innerHTML = `
            <label class="p-1">Pay Status Wise</label>
                <select class="form-control" id="pay_status" name="pay_status">
                    <option disabled selected hidden>Select Report Type</option>
                    <option value="payall">All</option>
                    <option value="pay_part">Part</option>
                    <option value="pay_full">Full</option>
                </select>
            `;
            dynamicDropdown.style.display = 'block';
        } else {
            dynamicDropdown.style.display = 'none';
        }
    });
</script>
<script>
    var fromDatePicker = document.getElementById('fromDate');
    var toDatePicker = document.getElementById('toDate');

    fromDatePicker.addEventListener('change', function () {
        // Handle "from" date selection
        var fromDate = fromDatePicker.value;
        var toDate = toDatePicker.value;  // Get the "to" date

        // Perform filtering based on fromDate and toDate
        filterDataByDate(fromDate, toDate);
    });

    toDatePicker.addEventListener('change', function () {
        // Handle "to" date selection
        var fromDate = fromDatePicker.value; // Get the "from" date
        var toDate = toDatePicker.value;

        // Perform filtering based on fromDate and toDate
        filterDataByDate(fromDate, toDate);
    });

    function filterDataByDate(fromDate, toDate) {
        var tableRows = document.querySelectorAll('.emInfo tbody tr'); // Select all table rows
        for (var i = 0; i < tableRows.length; i++) {
            var dateColumn = tableRows[i].querySelector('td:nth-child(4)'); // Assuming date column is the 4th column
            var dateValue = dateColumn.textContent; // Get the date value

            if (dateValue >= fromDate && dateValue <= toDate) {
                tableRows[i].style.display = ''; // Show the row if it's within the date range
            } else {
                tableRows[i].style.display = 'none'; // Hide the row if it's outside the date range
            }
        }
    }
</script>

{% endblock %}